<!DOCTYPE html><html lang="en-us"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>BlueStacks and Charles Proxy: A Better Love Story - evilsaloon</title><meta name="description" content="Recently, I came across a problem: my trusty rooted Android 4 phone couldn't install an app whose API I wanted to reverse engineer, because the app was targeting Android versions 7 and above. Instead of buying a newer phone for my needs, I started looking&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://evilsaloon.com/bluestacks-and-charles-proxy/"><link rel="alternate" type="application/atom+xml" href="https://evilsaloon.com/feed.xml"><link rel="alternate" type="application/json" href="https://evilsaloon.com/feed.json"><meta property="og:title" content="BlueStacks and Charles Proxy: A Better Love Story"><meta property="og:image" content="https://evilsaloon.com/media/posts/4/bst1-2.PNG"><meta property="og:image:width" content="1023"><meta property="og:image:height" content="559"><meta property="og:site_name" content="evilsaloon"><meta property="og:description" content="Recently, I came across a problem: my trusty rooted Android 4 phone couldn't install an app whose API I wanted to reverse engineer, because the app was targeting Android versions 7 and above. Instead of buying a newer phone for my needs, I started looking&hellip;"><meta property="og:url" content="https://evilsaloon.com/bluestacks-and-charles-proxy/"><meta property="og:type" content="article"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@evilsaloon"><meta name="twitter:title" content="BlueStacks and Charles Proxy: A Better Love Story"><meta name="twitter:description" content="Recently, I came across a problem: my trusty rooted Android 4 phone couldn't install an app whose API I wanted to reverse engineer, because the app was targeting Android versions 7 and above. Instead of buying a newer phone for my needs, I started looking&hellip;"><meta name="twitter:image" content="https://evilsaloon.com/media/posts/4/bst1-2.PNG"><link rel="shortcut icon" href="https://evilsaloon.com/media/website/avatar-3-2.png" type="image/png"><link rel="stylesheet" href="https://evilsaloon.com/assets/css/style.css?v=b985a690cb4f38bd47ea7da6a461aee7"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://evilsaloon.com/bluestacks-and-charles-proxy/"},"headline":"BlueStacks and Charles Proxy: A Better Love Story","datePublished":"2022-07-30T18:09","dateModified":"2022-07-30T18:16","image":{"@type":"ImageObject","url":"https://evilsaloon.com/media/posts/4/bst1-2.PNG","height":559,"width":1023},"description":"Recently, I came across a problem: my trusty rooted Android 4 phone couldn't install an app whose API I wanted to reverse engineer, because the app was targeting Android versions 7 and above. Instead of buying a newer phone for my needs, I started looking&hellip;","author":{"@type":"Person","name":"Maximilian Vidavsky","url":"https://evilsaloon.com/authors/maximilian-vidavsky/"},"publisher":{"@type":"Organization","name":"Maximilian Vidavsky","logo":{"@type":"ImageObject","url":"https://evilsaloon.com/media/website/avatar-3.png","height":3577,"width":3655}}}</script></head><body><div class="site-container"><header class="top" id="js-header"><a class="logo" href="https://evilsaloon.com/"><img src="https://evilsaloon.com/media/website/avatar-3.png" alt="evilsaloon" width="3655" height="3577"></a><nav class="navbar js-navbar"><button class="navbar__toggle js-toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://evilsaloon.com/" target="_self">Home</a></li><li><a href="https://evilsaloon.com/hello-world/" target="_self">About</a></li><li class="has-submenu"><span class="is-separator" aria-haspopup="true">Socials</span><ul class="navbar__submenu level-2" aria-hidden="true"><li><a href="https://twitter.com/evilsaloon" target="_self">Twitter</a></li><li><a href="https://instagram.com/evilsaloon" target="_self">Instagram</a></li><li><a href="https://t.me/evilsaloon" target="_self">Telegram</a></li><li><a href="https://github.com/evilsaloon" target="_self">Github</a></li><li><a href="mailto:max@evilsaloon.com" target="_self">E-mail</a></li></ul></li></ul></nav></header><main><article class="post"><div class="hero"><figure class="hero__image hero__image--overlay"><img src="https://evilsaloon.com/media/posts/4/bst1-2.PNG" srcset="https://evilsaloon.com/media/posts/4/responsive/bst1-2-xs.PNG 300w, https://evilsaloon.com/media/posts/4/responsive/bst1-2-sm.PNG 480w, https://evilsaloon.com/media/posts/4/responsive/bst1-2-md.PNG 768w, https://evilsaloon.com/media/posts/4/responsive/bst1-2-lg.PNG 1024w, https://evilsaloon.com/media/posts/4/responsive/bst1-2-xl.PNG 1360w, https://evilsaloon.com/media/posts/4/responsive/bst1-2-2xl.PNG 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="559" width="1023" alt=""></figure><header class="hero__content"><div class="wrapper"><div class="post__meta"><time datetime="2022-07-30T18:09">July 30, 2022</time></div><h1>BlueStacks and Charles Proxy: A Better Love Story</h1><div class="post__meta post__meta--author"><img src="https://www.gravatar.com/avatar/a89ba6f8f9cae9afa9d4208987881564?s&#x3D;240" loading="eager" height="240" width="240" class="post__author-thumb" alt="Maximilian Vidavsky"> <a href="https://evilsaloon.com/authors/maximilian-vidavsky/" class="feed__author">Maximilian Vidavsky</a></div></div></header></div><div class="wrapper post__entry"><p>Recently, I came across a problem: my trusty rooted Android 4 phone couldn't install an app whose API I wanted to reverse engineer, because the app was targeting Android versions 7 and above. Instead of buying a newer phone for my needs, I started looking towards emulators.</p><p>The first article I came across was from Mark Dappollone on <a href="https://mdapp.medium.com/the-android-emulator-and-charles-proxy-a-love-story-595c23484e02" target="_blank" rel="noopener noreferrer">Medium</a>, but it was published back in 2017 and didn't address my main concern: installing Android Studio just to use its emulator is a massive waste of time and hard drive space. Android Studio is completely unintuitive, and the emulator does not work on my machine at all.</p><p>Not only that, but it's meant for developers who can add their own SSL certificates into apps, which is impractical for reverse engineering, when we usually don't have access to the source code. Instead, I turned to an emulator I had used before, BlueStacks. This article will teach you how to root the BlueStacks emulator and use it to proxy calls.</p><h2>Step 1 - Installation</h2><p>Of course, you will need to install <a href="https://www.charlesproxy.com/download/latest-release/" target="_blank" rel="noopener noreferrer">Charles</a> first. For the emulator, I recommend <a href="https://www.bluestacks.com/download" target="_blank" rel="noopener noreferrer">downloading</a> the latest 64-bit version of BlueStacks 5, since it supports Hyper-V. Once downloaded and installed, launch the application once and let the emulator fully load.</p><p>Once loaded, close the emulator and download the latest version of <a href="https://bstweaker.tk/" target="_blank" rel="noopener noreferrer">BlueStacks Tweaker</a>. This nifty program will allow us to root the emulator, as well as install Xposed. The latest beta works with the latest version of BlueStacks 5 (5.9).</p><h2>Step 2 - Root + Xposed</h2><p>Open BlueStacks Tweaker and navigate to the "Root" tab. Make sure the emulator is closed and press "Unlock". This will unlock the emulator for rooting. Once that is done, press the "Play" button next to your emulator and wait for the emulator to load. Make sure you have Android Nougat (7.1), because BlueStacks Tweaker doesn't support the Android Pie beta yet.</p><figure class="post__image"><img loading="lazy" src="https://evilsaloon.com/media/posts/4//bst1.PNG" alt="" width="1023" height="559" sizes="100vw" srcset="https://evilsaloon.com/media/posts/4//responsive/bst1-xs.PNG 300w, https://evilsaloon.com/media/posts/4//responsive/bst1-sm.PNG 480w, https://evilsaloon.com/media/posts/4//responsive/bst1-md.PNG 768w, https://evilsaloon.com/media/posts/4//responsive/bst1-lg.PNG 1024w, https://evilsaloon.com/media/posts/4//responsive/bst1-xl.PNG 1360w, https://evilsaloon.com/media/posts/4//responsive/bst1-2xl.PNG 1600w"></figure><p>Once the emulator has loaded, press "Patch", then "Install SuperSu", then "Update Su binary". This will close the instance, so don't be surprised. Launch it again, and under the Xposed tab, press "Patch", "Install", and then "Flash". Restart the instance, and then open Xposed. It should say "Xposed Framework version 89 is active." and display a green checkmark. This means we can move onto step 3.</p><h2>Step 3 - Root Certificate + Proxy</h2><p>Now that our "device" is rooted and Xposed, we can start by setting the proxy. Kudos to u/ProgramTechie on Reddit for figuring out the <a href="https://www.reddit.com/r/BlueStacks/comments/oe2z02/comment/hwfpxte/?utm_source=share&amp;utm_medium=web2x&amp;context=3" target="_blank" rel="noopener noreferrer">steps</a>.</p><p>You will need an app like X-plore to edit the Android system files in order to add our proxy and Charles root certificate. Once you've downloaded and installed the app (you can drag the .apk file directly into the emulator), press the three dots in the top right corner and press "Configuration". You'll need to set the app into "Superuser + mount writable" mode.</p><p>Briefly head into Charles to set up your proxy. Be sure to turn off the default "Windows proxy" switch in the Proxy tab. Then press Proxy -&gt; Proxy Settings... click both of the switches under the HTTP proxy. After that, press Help -&gt; Local IP Address and take a note of your IP.</p><p>Then navigate to /data/system/users/0 (this will prompt the app to allow superuser access. Press "Accept".) and open "settings_global.xml" with the app's file editor. Then add these entries anywhere into the file, making sure to change the IP address to the one given to you by Charles:</p><p class="_1qeIAgB0cPwnLhDF9XSiJM"><code class="_34q3PgLsx9zIU5BiSOjFoM">&lt;setting id="100" name="global_proxy_pac_url" value="" package="android" /&gt;</code><br><code class="_34q3PgLsx9zIU5BiSOjFoM">&lt;setting id="97" name="global_http_proxy_host" value="192.168.1.10" package="android" /&gt;</code><br><code class="_34q3PgLsx9zIU5BiSOjFoM">&lt;setting id="98" name="global_http_proxy_port" value="8888" package="android" /&gt;</code><br><code class="_34q3PgLsx9zIU5BiSOjFoM">&lt;setting id="99" name="global_http_proxy_exclusion_list" value="" package="android" /&gt;</code><br><code class="_34q3PgLsx9zIU5BiSOjFoM">&lt;setting id="96" name="http_proxy" value="192.168.1.10:8888" package="com.android.shell" /&gt;</code></p><p>Once that is done, save the file and reboot the emulator. You should start seeing HTTP(S) queries in the list, but you will not be able to see HTTPS requests yet. Turn on the SSL proxy by pressing Proxy -&gt; SSL Proxying Settings, pressing the "Enable SSL Proxying" button and adding "*" as a location.</p><p>Now we need to install Charles' root certificate into the emulator. To do this, save Charles' root certificate locally by pressing Help -&gt; SSL Proxying -&gt; Save Charles Root Certificate..., and then save the file somewhere locally.</p><p>Next, you will need to add it manually into Android's certificate store. Install OpenSSL locally and navigate to wherever you saved the certificate. Then, type these two commands, courtesy of this StackOverflow <a href="https://stackoverflow.com/questions/44942851/install-user-certificate-via-adb/46569793#46569793" target="_blank" rel="noopener noreferrer">answer</a>:</p><p><code>openssl x509 -inform PEM -subject_hash_old -in cert.pem | head -1</code></p><p>Next, make a new text file with the name that OpenSSL gives you, with the extension .0. For example: 4a613d6b.0</p><p>After that, run this command:</p><p><code>openssl x509 -inform PEM -text -in cert.pem</code></p><p>And copy-paste the text into the text file we just created. Drag and drop this file into the emulator, and open X-plore again. You should find that file in /storage/emulated/0/Download. Copy that file to clipboard and paste it in /system/etc/security/cacerts.</p><p>Once that is done, download and install this Xposed <a href="https://github.com/ViRb3/TrustMeAlready" target="_blank" rel="noopener noreferrer">module</a>, go to the Xposed Installer -&gt; Modules and enable it. This disables SSL verification and pinning for most apps, making them trust Charles' root SSL certificate, allowing us to sniff the traffic.</p><p>Reboot the device, and voila! You now can sniff almost any apps' encrypted SSL traffic.</p></div><footer class="wrapper post__footer"><p class="post__last-updated">This article was updated on July 30, 2022</p><ul class="post__tag"><li><a href="https://evilsaloon.com/tags/android-proxy/">android proxy</a></li><li><a href="https://evilsaloon.com/tags/bluestacks/">bluestacks</a></li><li><a href="https://evilsaloon.com/tags/charles/">charles</a></li><li><a href="https://evilsaloon.com/tags/tutorial/">tutorial</a></li></ul><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fevilsaloon.com%2Fbluestacks-and-charles-proxy%2F" class="js-share facebook" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://evilsaloon.com/assets/svg/svg-map.svg#facebook"/></svg> <span>Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fevilsaloon.com%2Fbluestacks-and-charles-proxy%2F&amp;via=evilsaloon&amp;text=BlueStacks%20and%20Charles%20Proxy%3A%20A%20Better%20Love%20Story" class="js-share twitter" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://evilsaloon.com/assets/svg/svg-map.svg#twitter"/></svg> <span>Twitter</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fevilsaloon.com%2Fbluestacks-and-charles-proxy%2F" class="js-share linkedin" rel="nofollow noopener noreferrer"><svg class="icon" aria-hidden="true" focusable="false"><use xlink:href="https://evilsaloon.com/assets/svg/svg-map.svg#linkedin"/></svg> <span>LinkedIn</span></a></div><div class="post__bio bio"><img src="https://www.gravatar.com/avatar/a89ba6f8f9cae9afa9d4208987881564?s&#x3D;240" loading="lazy" height="240" width="240" class="bio__avatar" alt="Maximilian Vidavsky"><div class="bio__info"><h3 class="bio__name"><a href="https://evilsaloon.com/authors/maximilian-vidavsky/" rel="author">Maximilian Vidavsky</a></h3></div></div></footer></article><nav class="post__nav"><div class="post__nav-inner"><div class="post__nav-prev"><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://evilsaloon.com/assets/svg/svg-map.svg#arrow-prev"/></svg> <a href="https://evilsaloon.com/americas-secret-pager-giant/" class="post__nav-link" rel="prev"><span>Previous</span> America&#x27;s Secret Pager Giant</a></div><div class="post__nav-next"><a href="https://evilsaloon.com/is-there-finance-after-sanctions/" class="post__nav-link" rel="next"><span>Next</span> Is There Finance After Sanctions? </a><svg width="1.041em" height="0.416em" aria-hidden="true"><use xlink:href="https://evilsaloon.com/assets/svg/svg-map.svg#arrow-next"/></svg></div></div></nav></main><footer class="footer"><div class="footer__copyright"><p>Powered by Publii</p></div><button onclick="backToTopFunction()" id="backToTop" class="footer__bttop" aria-label="Back to top" title="Back to top"><svg><use xlink:href="https://evilsaloon.com/assets/svg/svg-map.svg#toparrow"/></svg></button></footer></div><script defer="defer" src="https://evilsaloon.com/assets/js/scripts.min.js?v=f47c11534595205f20935f0db2a62a85"></script><script>window.publiiThemeMenuConfig={mobileMenuMode:'sidebar',animationSpeed:300,submenuWidth: 'auto',doubleClickTime:500,mobileMenuExpandableSubmenus:true,relatedContainerForOverlayMenuSelector:'.top'};</script><script>var images = document.querySelectorAll('img[loading]');

        for (var i = 0; i < images.length; i++) {
            if (images[i].complete) {
                images[i].classList.add('is-loaded');
            } else {
                images[i].addEventListener('load', function () {
                    this.classList.add('is-loaded');
                }, false);
            }
        }</script></body></html>